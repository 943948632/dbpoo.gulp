$(window).bind('resize', doResize).trigger('resize');
function doResize() {
    if ($(window).width() <= 1600) {
        $('.sider-l').addClass('sl-m');
        $('.sider-r').addClass('sr-m');
    } else {
        $('.sider-l').removeClass('sl-m');
        $('.sider-r').removeClass('sr-m');
    }
}

var wheelPage=document.body;
if (wheelPage.addEventListener) {
    // IE9, Chrome, Safari, Opera
    wheelPage.addEventListener("mousewheel", wheelMouse, false);
    // Firefox
    wheelPage.addEventListener("DOMMouseScroll", wheelMouse, false);
}else{
    // IE 6/7/8
    wheelPage.attachEvent("onmousewheel", wheelMouse);
}

//右侧导航点击事件
$('.sider-r li').click(function() {
    $('.index-container').animate({'margin-top':'0px'});
    pageShow($(this).index()+1);
});

$('.sr-top').click(function() {
    $('.index-container').animate({'margin-top':'0px'});
    pageShow(0);
});

//展示某页
var currentPage = 0;
var scrollAnimationFinished = true;
function pageShow(index) {

    if (currentPage == index) return;
    scrollAnimationFinished = false;
    $('.sider-r li').removeClass('cur');
    if (index != 0) {
        $('.sider-r li').eq(index-1).addClass('cur');
    }

    if(currentPage == 5) {
        currentPage = 4;
    }

    //背景动画
    $('.sectionbg-box .sectionbg').removeClass('show').eq(index).addClass('show');
    var last = $('.section-'+currentPage);
    var target = $('.section-'+index);


    last.animate({top: (index < currentPage ? '150%' : '-150%')},300,function(){
        scrollAnimationFinished = true;
    });
    target.animate({top: 0},300,function(){
        scrollAnimationFinished = true;
    });
    currentPage = index;
}


//滚轮事件
function wheelMouse(event){
    //console.log(scrollAnimationFinished)
    if (scrollAnimationFinished == false) {
        return;
    }
    var e = window.event || event; // old IE support
    var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));

    if (delta > 0) {
        //向上滚动
        if (currentPage == 0) {
            pageShow(0);
        } else if (currentPage == 5) {
            //最后一页，往上滑，恢复
            $('.index-container').animate({'margin-top':'0'});
            currentPage = 4;
            $('.sider-r li').eq(3).addClass('cur');
        } else {
            pageShow(currentPage-1);
        }
    }else {
        if (currentPage < 4) {
            pageShow(currentPage+1);
        }
        else if (currentPage == 4) {
            //最后一页，往下滑，查看底部
            $('.index-container').animate({'margin-top':'-307px'});
            currentPage = 5;
            $('.sider-r li').removeClass('cur');
        }
    }
}

// 通头微信
var qrTimer;
$('.qr-hover').on('mouseover', function(){
    clearTimeout(qrTimer);
    qrshow();
});

$('.qr-hover').on('mouseout', function(){
    qrhide();
});

$('.qr-wx').on('mouseover', function(){
    clearTimeout(qrTimer);
    qrshow();
});

$('.qr-wx').on('mouseout', function(){
    qrhide();
});

function qrhide() {
    qrTimer = setTimeout(function(){
        $('.qr-wx').hide();
    },200)
}

function qrshow() {
    $('.qr-wx').show();
}

// 菜单
$('.s3pic-nav a').on('click', function(){
    var cur = $(this).data('pic');
    $('.s3pic-nav a').removeClass('on');
    $(this).addClass('on');
    $('.s3pic').hide();
    $('.s3pic-'+cur).show();
});

$('.s4pic-nav a.s4pnav').on('click', function(){
    var cur = $(this).data('pic');
    $('.s4pic-nav a').removeClass('on');
    $(this).addClass('on');
    $('.s4pic').hide();
    $('.s4pic-'+cur).show();
});

$('.s4pic-1 a').on('click', function(){
    var cur = $(this).data('weather');
    $('.s4picw').hide();
    $('.s4picw-'+cur).show();
});

$('.s4pnav-3').on('click', function(){
    show('picb-modal');
})

$('.s5pic-nav a').on('click', function(){
    var cur = $(this).data('pic');
    $('.s5pic-nav a').removeClass('on');
    $(this).addClass('on');
    $('.s5pic').hide();
    $('.s5pic-'+cur).show();
});

// 弹出大图
$('.s2-con a').on('click', function(){
    var url = $(this).data('pic');
    $('.pics-box').html('<img src="build/img201604/s2/pic_'+url+'.jpg" alt="">');
    show('pics-modal');
});

// 弹出视频
var player = '',$player = $('#videojs');
$(".s3pic a.open-video").on('click', function(){
    var curVideo = $(this).data('url');
    show('video-modal');
    $player.html(videoHTML(curVideo));
    if(player != '') {
        player.dispose();
    }
    player = videojs('#video-js');
});

function videoHTML(videoURL) {
    return '<video id="video-js" class="video-js vjs-default-skin" controls autoplay preload="none" width="793" height="496" data-setup="{}">' +
        '<source src="'+videoURL+'" type="video/mp4">'+
        '<p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>' +
        '</video>'
}

// 预约
var phonenameValue;
var phonetypeValue;
var phonenumValue;

$('.yy-select dd').on('click', function(){
    $('.yy-select dd').removeClass('select');
    $(this).addClass('select');
    phonenameValue = $('.select img').data('name');
    phonetypeValue = $('.select img').data('select');
});

$('.yy-inpbtn').on('click', function(){
    phonenumValue = $('#yy-phonenum').val();
    new Reserve({
        tablename : "anhei2_makeappointment_info",
        phonename : phonenameValue,
        phonetype : phonetypeValue,
        phonenum  : phonenumValue
    })
});

$(document).on('mouseup', function(e){
    if($(e.target).is('.modal')){
        modalHide();
    }
});

function show(curID){
    $('body').addClass('modal-open');
    $('#mask').show();
    $('#' + curID).show();
    scrollAnimationFinished = false;
}

function hide(curID){
    $('.modal,.modal-backdrop').hide();
    $('body').removeClass('modal-open');
    $('#mask').hide();
    $('#' + curID).hide();
    scrollAnimationFinished = true;
}

function modalHide(){
    $('.modal,.modal-backdrop').hide();
    $('body').removeClass('modal-open');
    $('#mask').hide();
    $player.html('');
    scrollAnimationFinished = true;
}

$('.yy-btn').on('click', function(){
    show('yuyue-modal');
});

$('.modal-close,.modal-backdrop').on('click', function(){
    modalHide();
});


function callback(data){
    modalHide();
    alert(data.message);
}